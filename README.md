# Дипломный проект профессии «1C-программист: с нуля до middle» (Коробка А.А.)
Реализовано в полном объеме
Кастомизация конфигурации «Управление IT-фирмой для компании «Ваш компьютерный мастер»

# Цель дипломного проекта
Разработать и подготовить к эксплуатации новый функциональный блок в конфигурации «Управление IT-фирмой»:
реализовать новые подсистемы «Работа с заявками клиентов» и «Расчёт управленческой зарплаты» в соответствии с требованиями заказчика,
подготовить отчёты по новой функциональности,
оформить инструкцию по начальной настройке,
подготовить автотест для проверки корректности работы подсистемы «Работа с заявками клиентов»,
загрузить результат работы в новый репозиторий на GitHub.
# Решение
## Описание нового функционала
# 1. Добавлена подсистема Обслуживание клиентов
# Документ Обслуживание клиентов
Процесс работы с заявками построен следующим образом:
Клиент звонит менеджеру и оставляет заявку на работу специалиста с указанием проблемы, для решения которой нужен специалист.
Менеджер ищет свободное время и планирует заявку на это время. При планировании телеграм-бот оповещает специалистов о появлении новой заявки.
Специалист в назначенное время в офисе клиента или удалённо проводит необходимые работы. Специалист получает подписанный лист учёта рабочего времени или скан/фото листа учёта от клиента.
В листе учёта перечисляются виды работ, выполненные специалистом, и фиксируется количество часов к оплате. В дальнейшем документ будет являться подтверждением проведения работ.
Специалист вносит в информационную систему информацию о выполненных работах, количество фактически потраченных часов на каждый вид работы, количество часов к оплате клиенту за каждый вид работы и прикрепляет к документу скан/фото листа учёта рабочего времени.
# Документы Обслуживание клиентов вводят специалисты и менджеры.
Для работы с данным документом созданы предопределенные профили пользователей BKM_Специалист и BKM_Менеджер по обслуживанию
# Документ Реализации товаров и услуг
В документе Реализации товаров и услуг добавлена возможность выбора договора с видом абонентская плата, с возможностью автозаполнения этого документа суммой ежемесячной абонентской платы и суммой за выполненные в течения месяца работы по данным документов Обслуживание клиентов. Из документа печатается акт об оказанных услугах.
# Документ Реализации товаров и услуг использует бухгалтер.
Для работы с данным документом создан предопределенный профиль пользователей BKM_Бухгалтер.
# Обработка Массовое создание документов Реализация товаров и услуг
В начале месяца бухгалтер фирмы формирует акты по всем абонентским договорам. Данный процесс автоматизирован.
# Массовое создание документов Реализации использует бухгалтер.
Для работы с данной обработкой создана роль BKM_Массовое создание документов Реализации. Эта роль подключена к предопределенному профилю пользователей BKM_Бухгалтер.
# Добавлена подсистема Расчёт управленческой зарплаты
На предприятии работают сотрудники двух категорий: специалисты и административный персонал. Специалистам начисляется минимальный оклад и процент за выполненные работы клиентам. Административный персонал получает оклад. Любому сотруднику на усмотрение руководства может быть начислена разовая фиксированная премия. С каждого сотрудника удерживается НДФЛ -13%.
# Для расчета зарплаты используется два документа:
Начисление заработной платы.
Начисление фиксированной премии.
# Планирование отпусков.
Механизм позволяет составлять график отпусков. Данные нужно вносить в начале года.
# Контроль заполнения графиков отпусков
Для визуального контроля пересечения отпусков сотрудника предусмотрена процедура контроля. При нажатии на кнопку Анализ графика открывается форма с диаграммой Ганта с информацией о каждом сотруднике.
# Подсистема Расчёт управленческой зарплаты
Для работы с подсистемой Расчёт управленческой зарплаты создан предопределенный профиль пользователей BKM_Кадровик-расчетчик.
# Отчеты
# Выработка специалистов.
Отчёт показывать, сколько часов за выбранный период отработал выбранный специалист и какая сумма ему за этот период начислена в виде процента от выплат клиента.
# Анализ выставленных актов
Отчёт включать информацию о клиентах, договорах и суммах, которые должны быть выставлены клиентам на основе данных из документов Обслуживание.
# Расчеты с сотрудниками
В отчете представлена информация о том, какие суммы начислены и выплачены каждому сотруднику за указанный период. Также в отчете отражена задолженность на начало и на конец этого периода.
# Расход запланированных отпусков
Пользователи строит отчёт за конкретный год. Отчет показывать сколько дней отпуска у сотрудника в выбранный период по плану и сколько дней он фактически был в отпуске.
# Добавлена подсистема ДобавленныеОбъекты
В данную подсистему включены все объекты добавленные в процессе доработки. Данную подсистему может видеть только администратор.
# Инструкция по начальной настройке и эксплуатации новых инструментов
# При первом запуске необходимо настроить дополнительный функционал Программного обеспечения.
# Все настройки осуществляются в режиме 1С предприятия:
  1. Создать пользователя с правами доступа Администратор (Профиль пользователя Администратор)
  2. Создать пользователей с правами доступа BKM_Бухгалтер, BKM_Кадровик-расчетчик, BKM_Специалист, BKM_Менеджер по обслуживанию выбрав соответствующий профиль пользователя
# Подсистема Обслуживание клиентов.
  1. В режиме администратора настроить: 
# Интеграция с Телеграм

## Документация

Документация по интеграции с Телеграм опубликована по [ссылке](https://core.telegram.org/bots/api). Инструкция ниже сформирована на основании этой документации.

## Подготовка

### Создание бота

1. Напишете в Телеграм [https://t.me/BotFather](https://t.me/BotFather) команду "/start"
2. Напишите команду "/newbot"
3. Выберите имя вашего бота, которое будут видеть пользователи
4. Выберите идентификатор вашего бота (он должен заканчиваться на "bot")
5. Скопируйте токен, который пришлет BotFather и сохраните его в константу

### Создание группы

1. Создайте группу в Телеграм
2. Добавьте в группу только что созданного бота
3. Назначьте боту права администратора

### Получите идентификатор группы

1. Напишите любое сообщение в группу
2. С помощью браузера или Postman выполните запрос `https://api.telegram.org/bot[ВашТокен]/getUpdates`. В полученном JSON найдите идентификатор группы, в которой получено сообщение, и сохраните его в константу.

## Отправка сообщений

1. Создайте общий модуль "Телеграм"
2. В модуле реализуйте метод, который получает на вход текст сообщения
3. В рамках метода:
    - создайте защищённое соединение с сервером "api.telegram.org"
    - создайте HTTP-запрос к ресурсу `/bot[ВашТокен]/sendMessage`
    - добавьте заголовок "Content-Type" со значением "application/json"
    - подготовьте структуру с полями:
        - "chat_id" - идентификатор группы из константы,
        - "text" - текст сообщения
    - установите JSON строку, полученную из структуры, в качестве тела HTTP-запроса
    - отправьте запрос с помощью метода "POST"
    - проверьте, что получет ответ с кодом состояния 200, если код состояния отличный от 200, получите тело ответа как строку и запишите в журнал регистрации информацию об ошибке.
